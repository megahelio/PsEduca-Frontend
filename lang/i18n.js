// Locale translations.
const locales = {

  // ES
  es: {
    contact: "Contacto",
    header: {
      logIn: "Iniciar sesión",
      logOut: "Cerrar sesión",
      navbar: {
        testAndPrograms: "Pruebas y programas",
        investigation: "Investigación",
        lines: "Líneas de<br>investigación",
        projects: "Proyectos",
        publications: "Publicaciones",
        thesis: "Tesis",
        tfgAndTfm: "TFG / TFM",
        divulgation: "Divulgación",
        formation: "Formación",
        catalog: "Catálogo",
        intranet: "Intranet",
        userManagement: "Gestión usuarios",
        membersManagement: "Gestión miembros",
        catalogManagement: "Gestión catálogo",
        formationManagement: "Gestión formación",
        divulgationManagement: "Gestión divulgación",
        pypManagement: "Gestión PyP"
      }
    },
    footer: {
      accesibility: "Accesibilidad",
      legalAdvice: "Aviso legal",
      dataProtection: "Protección de datos",
      group: {
        faculty: "Edificio de Facultades",
        location: "Las Lagunas, s/n<br>32004 Ourense",
        supportArea: "Área de apoyo",
        box: "Caja de quejas, sugerencias y felicitaciones",
      },
      uvigo: {
        seeMore: "Ver más",
        information: "Información",
        campusOurense: "Campus de Ourense",
        campusAgua: "Campus del Agua",
        campusPontevedra: "Campus de Pontevedra",
        campusCrea: "Campus CREA",
        campusVigo: "Campus de Vigo",
        vigoTech: "Vigo Tecnológico",
        otherWebs: "Otras webs intitucionales",
        campusMar: "Campus del Mar",
        transparency: "Transparencia",
        emergency: "Emergencias",
        socialWall: "Muro social",
      }
    },
    us: {
      title: "Quiénes somos",
      presentationTitle: "Presentación",
      membersTitle: "Miembros",
      linkInfoMember: "Más información",
      presentation: '<p>El Grupo de Investigación Psicoloxía da Educación e Desenvolvemento da UVigo (GiPEDUvi) ha centrado su investigación en el estudio de los procesos cognitivo-motivacionales implicados en el aprendizaje escolar; las variables personales y contextuales relacionadas con la convivencia, bienestar y éxito académico y las Necesidades Específicas de Apoyo Educativo.</p><p style="margin-bottom: 0;">Lineas de investigación actuales:</p><ul style="margin-top: 0;"><li>Evaluación e intervención en funciones y procesos cognitivos.</li><li>Evaluación e intervención en trastornos del neurodesarrollo y dificultades de aprendizaje.</li><li>Evaluación e intervención en procesos emocionales y motivacionales implicados en el aprendizaje.</li><li>Análisis e intervención funcional y conductual de grupos aula (acoso escolar).</li><li>Detección y reducción de barreras para inclusión educativa y social (minorías étnicas, pobreza, exclusión social).</li></ul><p style="margin-bottom: 0;">Servicios:</p><ul style="margin-top: 0;"><li>Identificación e interpretación del nivel de competencia intelectual y curricular del alumnado.</li><li>Detección, análisis e intervención funcional y/o conductual en las Necesidades Específicas de Apoyo Educativo (NEAE), en grupos de riesgo de acoso, abandono y absentismo escolar o de vulnerabilidad educativa.</li><li>Desarrollo de programas para la mejora de los procesos cognitivos en el aprendizaje de la lectura, escritura y cálculo.</li><li>Programas de intervención cognitiva para personas con dificultades de aprendizaje.</li><li>Diseño de materiales, recursos y metodologías en la detección de trastornos o dificultades orientados a optimización del desarrollo y del aprendizaje.</li><li>Asesoramiento y formación a familias, profesionales e instituciones del ámbito educativo y sociosanitario.</li></ul>'
    },
    login: {
      title: "Iniciar sesión",
      username: "Nombre de usuario",
      password: "Contraseña",
      submit: "Iniciar sesión",
    }, 
    usersManagement: {
      title: "Usuarios",
      name: "Nombre",
      username: "Usuario",
      role: "Rol",
      access: "Acceso",
      password: "Contraseña",
      confirmPassword: "Confirmar contraseña",
      save: "Guardar",
      delete: "Eliminar",
      titleDetail: "Información de usuario",
      createUser: "Crear usuario",
    },
    location: {
      title: "Localización",
      facultyOuName: "Facultad de Educación y Trabajo Social",
      facultyOuLocation: "Campus As Lagoas, s/n 32004 Ourense",
      facultyPoName: "Facultad de Ciencias de la Educación y del Deporte",
      facultyPoLocation: "Campus A Xunqueira, s/n 36005 Pontevedra",
    },
    contactPage: {
      title: "Contacto",
      name: "Nombre",
      email: "Correo electrónico",
      subject: "Asunto",
      message: "Mensaje",
      send: "Enviar",
    },
    membersManagement: {
      title: "Miembros",
      name: "Nombre",
      email: "Correo electrónico",
      description: "Descripción",
      link: "Link aportaciones",
      image: "Imagen",
      access: "Acceso",
      save: "Guardar",
      delete: "Eliminar",
      titleDetail: "Información del miembro",
      createMember: "Crear miembro",
    },
    formation: {
      titleActual: "Formación actual",
      titlePast: "Formación finalizada",
      masters: "Másteres",
      courses: "Cursos",
      doctorates: "Doctorados",
      type: "Tipo",
      title: "Formaciones",
      name: "Nombre",
      description: "Descripción",
      years: "Años",
      link: "Link",
      image: "Imagen",
      access: "Acceso",
      save: "Guardar",
      delete: "Eliminar",
      titleDetail: "Información de la formación",
      createFormation: "Crear formación",
      startYear: "Año de inicio",
      endYear: "Año de fin (opcional)",
    }

  },
  // EN
  en: {
    contact: "Contact",
    header: {
      logIn: "Log in",
      logOut: "Log out",
      navbar: {
        testAndPrograms: "Tests and programs",
        investigation: "Research",
        lines: "Research<br>lines",
        projects: "Projects",
        publications: "Publications",
        thesis: "Thesis",
        tfgAndTfm: "TFG / TFM",
        divulgation: "Divulgation",
        formation: "Formation",
        catalog: "Catalog",
        intranet: "Intranet",
        userManagement: "User management",
        membersManagement: "Members management",
        catalogManagement: "Catalog management",
        formationManagement: "Formation management",
        divulgationManagement: "Divulgation management",
        pypManagement: "PyP management"
      }
    },
    footer: {
      accesibility: "Accessibility",
      legalAdvice: "Legal advice",
      dataProtection: "Data protection",
      group: {
        faculty: "Faculty Building",
        location: "Las Lagunas, s/n<br>32004 Ourense",
        supportArea: "Support area",
        box: "Complaints, suggestions and congratulations box",
      },
      uvigo: {
        seeMore: "See more",
        information: "Information",
        campusOurense: "Ourense Campus",
        campusAgua: "Water Campus",
        campusPontevedra: "Pontevedra Campus",
        campusCrea: "CREA Campus",
        campusVigo: "Vigo Campus",
        vigoTech: "Vigo Technological",
        otherWebs: "Other institutional websites",
        campusMar: "Sea Campus",
        transparency: "Transparency",
        emergency: "Emergencies",
        socialWall: "Social wall",
      }
    },
    us: {
      title: "Who we are",
      presentationTitle: "Presentation",
      membersTitle: "Members",
      linkInfoMember: "More information",
      presentation: '<p>The Research Group on Educational Psychology and Development of UVigo (GiPEDUvi) has focused its research on the study of cognitive-motivational processes involved in school learning; personal and contextual variables related to coexistence, well-being, and academic success, as well as Specific Educational Support Needs.</p><p style="margin-bottom: 0;">Current lines of research:</p><ul style="margin-top: 0;"><li>Evaluation and intervention in cognitive functions and processes.</li><li>Evaluation and intervention in neurodevelopmental disorders and learning difficulties.</li><li>Evaluation and intervention in emotional and motivational processes involved in learning.</li><li>Functional and behavioral analysis and intervention of classroom groups (bullying).</li><li>Detection and reduction of barriers to educational and social inclusion (ethnic minorities, poverty, social exclusion).</li></ul><p style="margin-bottom: 0;">Services:</p><ul style="margin-top: 0;"><li>Identification and interpretation of students\' intellectual and curricular competence levels.</li><li>Detection, analysis, and functional and/or behavioral intervention for Specific Educational Support Needs (NEAE), in at-risk groups for bullying, dropout, absenteeism, or educational vulnerability.</li><li>Development of programs to improve cognitive processes in the learning of reading, writing, and arithmetic.</li><li>Cognitive intervention programs for people with learning difficulties.</li><li>Design of materials, resources, and methodologies for the detection of disorders or difficulties aimed at optimizing development and learning.</li><li>Advice and training for families, professionals, and institutions in the educational and social-health fields.</li></ul>'

    },
    login: {
      title: "Log in",
      username: "Username",
      password: "Password",
      submit: "Log in",
    },
    usersManagement: {
      title: "Users",
      name: "Name",
      username: "Username",
      role: "Role",
      access: "Access",
      password: "Password",
      confirmPassword: "Confirm password",
      save: "Save",
      delete: "Delete",
      titleDetail: "User detail",
      createUser: "Create user",
    },
    location: {
      title: "Location",
      facultyOuName: "Faculty of Education and Social Work",
      facultyOuLocation: "Campus As Lagoas, s/n 32004 Ourense",
      facultyPoName: "Faculty of Education and Sport Sciences",
      facultyPoLocation: "Campus A Xunqueira, s/n 36005 Pontevedra",
    },
    contactPage: {
      title: "Contact",
      name: "Name",
      email: "Email",
      subject: "Subject",
      message: "Message",
      send: "Send",
    },
    membersManagement: {
      title: "Members",
      name: "Name",
      email: "Email",
      description: "Description",
      link: "Contributions link",
      image: "Image",
      access: "Access",
      save: "Save",
      delete: "Delete",
      titleDetail: "Member detail",
      createMember: "Create member",
    },
    formation: {
      titleActual: "Current formation",
      titlePast: "Finished formation",
      masters: "Masters",
      courses: "Courses",
      doctorates: "Doctorates",
      type: "Type",
      title: "Formations",
      name: "Name",
      description: "Description",
      years: "Years",
      link: "Link",
      image: "Image",
      access: "Access",
      save: "Save",
      delete: "Delete",
      titleDetail: "Formation detail",
      createFormation: "Create formation",
      startYear: "Start year",
      endYear: "End year (optional)",
    }
  },

  // GL
  gl: {
    contact: "Contacto",
    header: {
      logIn: "Iniciar sesión",
      logOut: "Cerrar sesión",
      navbar: {
        testAndPrograms: "Probas e programas",
        investigation: "Investigación",
        lines: "Liñas de<br>investigación",
        projects: "Proxectos",
        publications: "Publicacións",
        thesis: "Teses",
        tfgAndTfm: "TFG / TFM",
        divulgation: "Divulgación",
        formation: "Formación",
        catalog: "Catálogo",
        intranet: "Intranet",
        userManagement: "Xestión usuarios",
        membersManagement: "Xestión membros",
        catalogManagement: "Xestión catálogo",
        formationManagement: "Xestión formación",
        divulgationManagement: "Xestión divulgación",
        pypManagement: "Xestión PyP"
      }
    },
    footer: {
      accesibility: "Accesibilidade",
      legalAdvice: "Aviso legal",
      dataProtection: "Protección de datos",
      group: {
        faculty: "Edificio de Facultades",
        location: "As Lagunas, s/n<br>32004 Ourense",
        supportArea: "Área de apoio",
        box: "Caixa de queixas, suxerencias e felicitacións",
      },
      uvigo: {
        seeMore: "Ver máis",
        information: "Información",
        campusOurense: "Campus de Ourense",
        campusAgua: "Campus da Auga",
        campusPontevedra: "Campus de Pontevedra",
        campusCrea: "Campus CREA",
        campusVigo: "Campus de Vigo",
        vigoTech: "Vigo Tecnolóxico",
        otherWebs: "Outras webs institucionais",
        campusMar: "Campus do Mar",
        transparency: "Transparencia",
        emergency: "Emerxencias",
        socialWall: "Muro social",
      }
    },
    us: {
      title: "Quen somos",
      presentationTitle: "Presentación",
      membersTitle: "Membros",
      linkInfoMember: "Máis información",
      presentation: '<p>O Grupo de Investigación Psicoloxía da Educación e do Desenvolvemento da UVigo (GiPEDUvi) centrou a súa investigación no estudo dos procesos cognitivo-motivacionais implicados na aprendizaxe escolar; as variables persoais e contextuais relacionadas coa convivencia, o benestar e o éxito académico, así como as Necesidades Específicas de Apoio Educativo.</p><p style="margin-bottom: 0;">Liñas de investigación actuais:</p><ul style="margin-top: 0;"><li>Avaliación e intervención en funcións e procesos cognitivos.</li><li>Avaliación e intervención en trastornos do neurodesenvolvemento e dificultades de aprendizaxe.</li><li>Avaliación e intervención en procesos emocionais e motivacionais implicados na aprendizaxe.</li><li>Análise e intervención funcional e conductual de grupos aula (acoso escolar).</li><li>Detección e redución de barreiras para a inclusión educativa e social (minorías étnicas, pobreza, exclusión social).</li></ul><p style="margin-bottom: 0;">Servizos:</p><ul style="margin-top: 0;"><li>Identificación e interpretación do nivel de competencia intelectual e curricular do alumnado.</li><li>Detección, análise e intervención funcional e/ou conductual nas Necesidades Específicas de Apoio Educativo (NEAE), en grupos de risco de acoso, abandono e absentismo escolar ou de vulnerabilidade educativa.</li><li>Desenvolvemento de programas para a mellora dos procesos cognitivos na aprendizaxe da lectura, escritura e cálculo.</li><li>Programas de intervención cognitiva para persoas con dificultades de aprendizaxe.</li><li>Deseño de materiais, recursos e metodoloxías para a detección de trastornos ou dificultades orientados á optimización do desenvolvemento e da aprendizaxe.</li><li>Asesoramento e formación a familias, profesionais e institucións do ámbito educativo e sociosanitario.</li></ul>'
    },
    login: {
      title: "Iniciar sesión",
      username: "Nome de usuario",
      password: "Contrasinal",
      submit: "Iniciar sesión",
    },
    usersManagement: {
      title: "Usuarios",
      name: "Nome",
      username: "Usuario",
      role: "Rol",
      access: "Acceso",
      password: "Contrasinal",
      confirmPassword: "Confirmar contrasinal",
      save: "Gardar",
      delete: "Eliminar",
      titleDetail: "Información de usuario",
      createUser: "Crear usuario",
    },
    location: {
      title: "Localización",
      facultyOuName: "Facultade de Educación e Traballo Social",
      facultyOuLocation: "Campus As Lagoas, s/n 32004 Ourense",
      facultyPoName: "Facultade de Ciencias da Educación e do Deporte",
      facultyPoLocation: "Campus A Xunqueira, s/n 36005 Pontevedra",
    },
    contactPage: {
      title: "Contacto",
      name: "Nome",
      email: "Correo electrónico",
      subject: "Asunto",
      message: "Mensaxe",
      send: "Enviar",
    },
    membersManagement: {
      title: "Membros",
      name: "Nome",
      email: "Correo electrónico",
      description: "Descrición",
      link: "Link aportacións",
      image: "Imaxe",
      access: "Acceso",
      save: "Gardar",
      delete: "Eliminar",
      titleDetail: "Información do membro",
      createMember: "Crear membro",
    },
    formation: {
      titleActual: "Formación actual",
      titlePast: "Formación finalizada",
      masters: "Másteres",
      courses: "Cursos",
      doctorates: "Doctorados",
      type: "Tipo",
      title: "Formacións",
      name: "Nome",
      description: "Descrición",
      years: "Anos",
      link: "Link",
      image: "Imaxe",
      access: "Acceso",
      save: "Gardar",
      delete: "Eliminar",
      titleDetail: "Información da formación",
      createFormation: "Crear formación",
      startYear: "Ano de inicio",
      endYear: "Ano de fin (opcional)",
    }
  },
};

const availableLocales = ['es', 'en', 'gl'];
const defaultLanguage = 'es';

function resolveLanguage(language) {
  if(language && availableLocales.includes(language.toLowerCase())) {
    return language;
  }

  const sessionLanguage = sessionStorage.getItem('language');
  if (sessionLanguage && availableLocales.includes(sessionLanguage)) {
    return sessionLanguage;
  }

  const windowLanguage = (window.navigator.userLanguage || window.navigator.language).substr(0, 2);
  if (windowLanguage && availableLocales.includes(windowLanguage)) {
    return windowLanguage;
  }
  
  return defaultLanguage;
}

export function setPageLanguage(language) {
  const pageLanguage = resolveLanguage(language);
  sessionStorage.setItem('language', pageLanguage);

  // Get all page elements to be translated.
  const elements = document.querySelectorAll('[data-i18n]');
  
  // Get JSON object of translations.
  const json = locales[pageLanguage];
  
  // On each element, found the translation from JSON file & update.
  elements.forEach((element, _) => {
    const key = element.getAttribute('data-i18n');
    let text = key.split('.').reduce((obj, i) => (obj ? obj[i] : null), json);
  
    // Does this text have any variables? (eg {something})
    const variables = text.match(/{(.*?)}/g);
    if (variables) {
  
      // Iterate each variable in the text.
      variables.forEach((variable) => {
  
        // Filter all `data-*` attributes for this element to find the matching key.
        Object.entries(element.dataset).filter(([key, value]) => {
          if (`{${key}}` === variable) {
            try {
              // Attempt to run actual JavaScript code.
              text = text.replace(`${variable}`, new Function(`return (${value})`)());
            } catch (error) {
              // Probably just static text replacement.
              text = text.replace(`${variable}`, value);
            }
          }
        })
      });
    }
  
    // Regular text replacement for given locale.
    element.innerHTML = text;
  });
  
  // Set <html> tag lang attribute.
  const htmlElement = document.querySelector('html');
  htmlElement.setAttribute('lang', pageLanguage);
}

export function getPageLanguage() {
  return sessionStorage.getItem('language') ?? defaultLanguage;
}